(()=>{"use strict";var t={607:function(t,e,i){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Query=void 0;const r=s(i(108)),n=i(630);e.Query=class{constructor(t={}){this._buildmsqlQueries=[],this._buildmsqlOptions=t}async createConnection(t){return this.proxy(await r.default.createConnection(t))}createPool(t){return this._buildmsqlPool=r.default.createPool(t),this._buildmsqlPool}createPoolCluster(t){return this._buildmsqlPool=r.default.createPoolCluster(t),this._buildmsqlPool}getPool(){if(void 0===this._buildmsqlPool)throw Error("pool is undefined");return this._buildmsqlPool}async getConnection(t,e){if(void 0===this._buildmsqlPool)throw Error("pool is undefined");return e=(t=t||this._buildmsqlOptions.pattern)||this._buildmsqlOptions.selector,this.proxy(await this._buildmsqlPool.getConnection(t,e))}async poolQuery(t,e){if(void 0===this._buildmsqlPool)throw Error("pool is undefined");const i=await this.getConnection();try{return await this.query(t,e)}catch(t){throw t}finally{await i.release()}}async poolQueryStream(t,e){if(void 0===this._buildmsqlPool)throw Error("pool is undefined");const i=await this.getConnection();return this.queryStream(t,e).on("end",(async()=>{await i.release()}))}async poolBatch(t,e){if(void 0===this._buildmsqlPool)throw Error("pool is undefined");const i=await this.getConnection();try{return await this.batch(t,e)}catch(t){throw t}finally{await i.release()}}async poolInsert(t,e,i){if(void 0===this._buildmsqlPool)throw Error("pool is undefined");const s=await this.getConnection();try{return await this.insert(t,e,i)}catch(t){throw t}finally{await s.release()}}async poolUpdate(t,e,i,s){if(void 0===this._buildmsqlPool)throw Error("pool is undefined");const r=await this.getConnection();try{return await this.update(t,e,i,s)}catch(t){throw t}finally{await r.release()}}_setConnection(t){this._buildmsqlConnection=t}proxy(t){return this._setConnection(t),new Proxy(t,{get:(t,e,i)=>Reflect.has(this,e)?Reflect.get(this,e,i):Reflect.get(t,e,i)})}async query(t,e){try{this._debugStart(t,e);const i=await this._buildmsqlConnection.query(t,e);return this._buildmsqlMeta=i.hasOwnProperty("meta")?i.meta:i,i}catch(t){throw t}finally{this._debugEnd()}}queryStream(t,e){return this._debugStart(t,e),this._buildmsqlConnection.queryStream(t,e).on("error",(async()=>{this._debugEnd()})).on("fields",(t=>{this._buildmsqlMeta=t})).on("end",(async()=>{this._debugEnd()}))}async batch(t,e){try{this._debugStart(t,e);const i=await this._buildmsqlConnection.batch(t,e);return this._buildmsqlMeta=i,i}catch(t){throw t}finally{this._debugEnd()}}async beginTransaction(){this._buildmsqlOptions.nativeTransactions?await this.query("\nSTART TRANSACTION"):await this._buildmsqlConnection.beginTransaction()}async rollback(){this._buildmsqlOptions.nativeTransactions?await this.query("\nROLLBACK"):await this._buildmsqlConnection.rollback()}async commit(){this._buildmsqlOptions.nativeTransactions?await this.query("\nCOMMIT"):await this._buildmsqlConnection.commit()}getMeta(){return this._buildmsqlMeta}lastInsertId(){return Array.isArray(this._buildmsqlMeta)?void 0:this._buildmsqlMeta.insertId}affectedRows(){return Array.isArray(this._buildmsqlMeta)?void 0:this._buildmsqlMeta.affectedRows}warningStatus(){return Array.isArray(this._buildmsqlMeta)?void 0:this._buildmsqlMeta.warningStatus}quote(t){return this._buildmsqlConnection.escape(t)}async insert(t,e,i){const s=Array.isArray(e);(i=i||{}).returning=!0===i.returning?Object.keys(s?e[0]:e):i.returning,i.duplicate=!0===i.duplicate?Object.keys(s?e[0]:e):i.duplicate,i.chunk=i.chunk||(s?e.length:1);const r=i.replace?"REPLACE":"INSERT",n=i.ignore&&!i.replace?"IGNORE":"",o=Array.isArray(i.returning)&&i.returning.length?`RETURNING ${i.returning.join(", ")}`:"",a=Array.isArray(i.duplicate)&&i.duplicate.length&&!i.replace?`ON DUPLICATE KEY UPDATE ${i.duplicate.map((t=>`${t}=VALUES(${t})`)).join(", ")}`:"",l=`\n            ${r} ${n} ${t} (${s?Object.keys(e[0]).join(", "):Object.keys(e).join(", ")}) \n            VALUES (${s?Object.keys(e[0]).map((t=>`:${t}`)).join(", "):Object.keys(e).map((t=>`:${t}`)).join(", ")}) \n            ${a} \n            ${o};\n        `,u=i.chunk;let d;for(let i=0,r=s?e.length:1;i<r;i+=u){const r=s?e.slice(i,i+u):e;d=u>1?await this.batch({sql:l,namedPlaceholders:!0},r):await this.query({sql:l,namedPlaceholders:!0},r),this._buildmsqlConnection.emit("inserted",t,d)}return d}async update(t,e,i,s){s=s||{};const r=Object.keys(i).map((t=>`${t} = :${t}`)).join(", "),n=`UPDATE ${s.ignore?"IGNORE":""} ${t} SET ${r} WHERE ${e};`,o=await this.query({sql:n,namedPlaceholders:!0},i);return this._buildmsqlConnection.emit("updated",t,o),o}statistics(){return{count:this._buildmsqlQueries.length,time:Math.round(100*this._buildmsqlQueries.reduce(((t,e)=>t+e.time),0))/100,queries:this._buildmsqlQueries}}_debugStart(t,e){if(this._buildmsqlOptions.debug){let i="object"==typeof t?t.sql:t;e&&(Array.isArray(e)?e.map((t=>i=i.replace("?",this.quote(t)))):Object.keys(e).map((t=>i=i.replace(new RegExp(":"+t,"ig"),this.quote(e[t]))))),this._buildmsqlQueries.push({threadId:this._buildmsqlConnection.threadId,start:n.performance.now(),time:0,sql:i})}}_debugEnd(){if(this._buildmsqlOptions.debug){const t=this._buildmsqlQueries.pop();t&&t.start&&(t.time=Math.round(100*(n.performance.now()-t.start))/100,delete t.start,this._buildmsqlQueries.push(t))}}}},108:t=>{t.exports=require("mariadb")},630:t=>{t.exports=require("perf_hooks")}},e={},i=function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}(607);module.exports=i})();